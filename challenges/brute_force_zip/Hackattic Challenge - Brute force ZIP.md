---
url: https://hackattic.com/challenges/brute_force_zip
code_url: https://github.com/hitanshu-dhawan/Hackattic
---

# Brute force ZIP

Grab the `zip_url` from the problem endpoint, download the ZIP file. Inside, among other things that you can rummage through, is a file called `secret.txt` which contains the solution to this challenge. But the ZIP is password protected, and I'm not giving you the password.

The password is between 4-6 characters long, lowercase and numeric. ASCII only.

You'll probably need to brute-force your way to the `secret.txt` file. Oh, and you have 30 seconds until the problem expires.

Go! Use the force!

##### Getting the problem set

`GET /challenges/brute_force_zip/problem?access_token=<access_token>`

Problem JSON will contain only one key:

- `zip_url`: the one-time URL for the ZIP file you'll need to brute-force

##### Submitting a solution

`POST /challenges/brute_force_zip/solve?access_token=<access_token>`

Solution JSON structure:

- `secret`: the secret value you found inside the `secret.txt` file

##### Why this challenge?

It occurred to me I never really looked into what the ZIP format is. Is there a spec? Is it proprietary? How does it encrypt stuff? It's all [pretty cool](https://en.wikipedia.org/wiki/Zip_\(file_format\)).

So until I come up with a challenge that deals with the format directly, here's a throwback to the one time we all forgot a ZIP password. Or... downloaded something with a password.

PS. I swear the name of this challenge sounds like a grunge/metal/post-punk/nu-rock band.

---
# Solution

-- Generated by ChatGPT.

A known-plaintext attack (KPA) is a cryptographic attack where the attacker has access to both the plaintext (original unencrypted data) and its corresponding ciphertext (encrypted data). By analyzing these pairs, the attacker attempts to deduce the encryption key or algorithm used, potentially allowing them to decrypt other ciphertexts encrypted with the same key.

In the context of ZIP files, particularly those encrypted using the legacy PKZIP stream cipher, a known-plaintext attack can exploit vulnerabilities to recover the original password or decrypt the archive without it. The PKZIP stream cipher initializes three 32-bit keys (key0, key1, and key2) using the supplied password. These keys are then updated with each byte of plaintext processed.

#### **How the Attack Works**

1. **Obtain Known Plaintext:**
    - Identify a file within the encrypted ZIP archive for which you have the exact unencrypted version. This known plaintext is crucial for the attack's success.
2. **Compress the Known Plaintext:**
    - Compress the known plaintext file using the same compression method and ZIP software as was used for the encrypted archive. This ensures that the compressed plaintext matches the structure of the encrypted data.
3. **Execute the Attack:**
    - Utilize a tool like pkcrack to perform the known-plaintext attack. pkcrack compares the encrypted file with the compressed known plaintext to deduce the internal state of the encryption keys.
4. **Recover the Encryption Keys:**
    - Once the internal state is determined, pkcrack can derive the encryption keys, allowing for the decryption of the entire ZIP archive without needing the original password.

#### **Using pkcrack**

pkcrack is an implementation of the known-plaintext attack against PKZIP's stream cipher. Here's a step-by-step guide on how to use it:

1. **Prepare the Files:**
    - Ensure you have both the encrypted ZIP archive and a ZIP archive containing the known plaintext file compressed with the same method.
2. **Run pkcrack:**
    - Execute the following command:
        ```
        pkcrack -C encrypted.zip -c encryptedfile -P plaintext.zip -p plaintextfile -d decrypted.zip -a
        ```
        Where:
        - `encrypted.zip` is the encrypted ZIP archive.
        - `encryptedfile` is the specific file within the encrypted archive.
        - `plaintext.zip` is the ZIP archive containing the known plaintext.
        - `plaintextfile` is the known plaintext file within `plaintext.zip`.
        - `decrypted.zip` is the output file where the decrypted content will be saved.
        - The `-a` flag enables an additional search for better performance.
3. **Wait for Completion:**
    - The duration of the attack depends on the size of the known plaintext and the processing power of your machine. Larger known plaintext sizes generally result in faster recovery times.
4. **Access Decrypted Files:**
    - After completion, `decrypted.zip` will contain the decrypted files, accessible without a password.

#### **Considerations**

- **Partial Plaintext:** If only a portion of the plaintext is known, pkcrack can still attempt the attack using the `-o` option to specify the offset where the known plaintext begins within the encrypted file.
- **Compression Method:** The success of the attack heavily relies on the known plaintext being compressed using the same method as the encrypted file. Mismatched compression methods can lead to unsuccessful attacks.
- **Encryption Type:** This attack is applicable to ZIP archives encrypted with the legacy PKZIP stream cipher. ZIP files encrypted with stronger algorithms like AES are not susceptible to this method.

By leveraging the known-plaintext attack, tools like pkcrack can effectively decrypt legacy-encrypted ZIP files without requiring the original password, highlighting the importance of using robust encryption methods in data protection.

---
# Resources

- https://github.com/keyunluo/pkcrack
- Sample code in Go
  https://github.com/therin/hackattic/blob/master/pkg/brute_force_zip/brute_force_zip.go
- https://cointelegraph.com/explained/known-plaintext-attacks-explained
- https://math.ucr.edu/~mike/zipattacks.pdf
- https://www.scitepress.org/Papers/2019/73605/73605.pdf


#Hackattic
